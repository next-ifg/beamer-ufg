%% -*- coding: utf-8; -*-
% Nome           : beamerthemeufg.sty
% Autor          : Pedro Maione (pedromaionee@gmail.com)
% Versão         : 0.1
% Criado em      : 2017-08-28
% Copyright      : Copyright (c) 2017 by Pedro Maione. All rights reserved.
% Licença        : This file may be distributed and/or modified under the
% GNU Public License.
% Descrição      : Tema do Beamer para apresentações na Escola de Engenharia Elétrica, Mecânica e de Computação da Universidade Federal de Goiás (UFG)


\ProvidesPackage{beamerthemeufg}[2017/08/28]

\RequirePackage{lmodern}

\RequirePackage[T1]{fontenc}
\RequirePackage[utf8]{inputenc}
\RequirePackage[english,spanish,brazilian]{babel}

\RequirePackage{tikz}
\RequirePackage{xcolor}

\RequirePackage{multicol}
\RequirePackage{tabularx}
\RequirePackage{ragged2e}

\RequirePackage{graphicx}


\usetikzlibrary{mindmap,backgrounds,positioning,calc}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{shapes.misc}

\DeclareGraphicsExtensions{.png,.jpeg,.jpg,.pdf}

\graphicspath{%
  {./},%
  {./figs/},%
}

%% \usepackage{eso-pic}

\newif\if@doSans
\@doSansfalse
\DeclareOption{noserifmath}{\@doSanstrue}
\newif\if@doNoFlama
\@doNoFlamafalse
\DeclareOption{noflama}{\@doNoFlamatrue}
\newif\if@doSectionPage
\@doSectionPagefalse
\DeclareOption{nosectionpages}{\@doSectionPagetrue}
\ProcessOptions

\mode<presentation>

% ---------------------------------------------------------------------
% TOC
% ---------------------------------------------------------------------
\useoutertheme[subsection=false,shadow]{miniframes}
\setbeamertemplate{section in toc}[sections numbered]
\setbeamertemplate{subsection in toc}[subsections numbered]

% ---------------------------------------------------------------------
% custom commands
% ---------------------------------------------------------------------
% \newcommand{\rightTextArrow}{ $rightarrow$ }
% \newcommand{\quoted}[1]{>#1<}
% \newcommand{\doublequoted}[1]{>>#1<<}

% ---------------------------------------------------------------------
% Itemize
% ---------------------------------------------------------------------
% \setbeamertemplate{itemize item}{}
% \setbeamertemplate{itemize subitem}{}
% \setbeamertemplate{itemize subsubitem}{}


\setbeamertemplate{caption}[numbered]


\setlength{\parskip}{0.5em}

% ---------------------------------------------------------------------
% Colors
% ---------------------------------------------------------------------


\definecolor{ufgBlue}{HTML}{005EB8}
\definecolor{ufgYellow}{HTML}{FFF000}

% Primary Colors
\definecolor{ufgRed}{rgb}{0.882352941,0,0.098039216}
\definecolor{ufgRedDark}{rgb}{0.588235294,0,0.058823529}
\definecolor{ufgWarmGreyDark}{HTML}{505050}
\definecolor{ufgWarmGreyLight}{HTML}{DDDDDD}

% Secondary Colors
\definecolor{ufgSec1}{rgb}{0,0.588235294,0.509803922}
\definecolor{ufgSec1Dark}{rgb}{0,0.392156863,0.31372549}
\definecolor{ufgSec1Comp}{rgb}{0.294117647,0.745098039,0.882352941}
\definecolor{ufgSec1CompDark}{rgb}{0.196078431,0.490196078,0.568627451}

\definecolor{ufgSec2}{rgb}{0.607843137,0.764705882,0.156862745}
\definecolor{ufgSec2Dark}{rgb}{0.411764706,0.490196078,0.098039216}
\definecolor{ufgSec2Comp}{rgb}{0.254901961,0.156862745,0.509803922}
\definecolor{ufgSec2CompDark}{rgb}{0.176470588,0.098039216,0.333333333}

\definecolor{ufgSec3}{rgb}{0.509803922,0.078431373,0.31372549}
\definecolor{ufgSec3Dark}{rgb}{0.338345865,0.058823529,0.196078431}
\definecolor{ufgSec3Comp}{rgb}{1,0.509803922,0}
\definecolor{ufgSec3CompDark}{rgb}{0.666666667,0.333333333,0}


% General
\setbeamercolor{normal text}{fg=ufgWarmGreyDark}
\setbeamercolor{structure}{fg=ufgWarmGreyDark}
\setbeamercolor{alerted text}{fg=ufgRed}
\setbeamercolor{example text}{fg=white}
\setbeamercolor{copyright text}{fg=ufgWarmGreyLight}
\setbeamercolor{palette primary}{fg=ufgWarmGreyDark}
\setbeamercolor{palette secondary}{fg=ufgWarmGreyDark,bg=ufgWarmGreyLight}
\setbeamercolor{palette tertiary}{fg=black,bg=ufgWarmGreyLight}
\setbeamercolor{palette quaternary}{fg=white, bg=ufgBlue}
% Titlepage
\setbeamercolor{title}{parent=normal text}
\setbeamercolor{subtitle}{parent=normal text}
\setbeamercolor{institute}{parent=normal text}
% Content
\setbeamercolor{frametitle}{parent=palette quaternary}
% Blocks
\setbeamercolor{block title}{parent=palette quaternary}
\setbeamercolor{block body}{parent=palette secondary}
\setbeamercolor{block title example}{fg=white, bg=ufgSec1Dark}
\setbeamercolor{block body example}{fg=white, bg=ufgSec1}
\setbeamercolor{block title alerted}{fg=white, bg=ufgRedDark}
\setbeamercolor{block body alerted}{fg=white, bg=ufgRed}
% Notes
\setbeamercolor{note page}{fg=ufgWarmGreyDark,bg=ufgWarmGreyLight}
\setbeamercolor{note title}{fg=white, bg=ufgWarmGreyDark}
\setbeamercolor{note date}{parent=note title}
% Page Number
\setbeamercolor{page number in head/foot}{fg=black}

% % ---------------------------------------------------------------------
% % Fonts
% % ---------------------------------------------------------------------

% % General
% % \usepackage{fontspec}%	
% % \newfontfamily\Light{Droid Sans}%
% % \newfontfamily\Book{Droid Sans Bold}%
% % \newfontfamily\Medium{Droid Sans Bold}%
% % \setsansfont{Droid Sans}%

% % % Declare fontfamilys
% % \if@doNoFlama%
% % 	% Sans serif math option
% % \if@doSans%
% % 		% sans serif math %
% % \usepackage[no-math]{fontspec}%	
% % \setmainfont{Droid-Sans}%
% % \else%
% % 		% serif math %
% % \usepackage{fontspec}%	
% % \usefonttheme[onlymath]{serif}%
% % \fi%
% % \newfontfamily\Light{Arial}%
% % \newfontfamily\Book{Arial-Bold}%
% % \newfontfamily\Medium{Arial-Bold}%
% % \setsansfont{Arial}%
% % \else%
% % 	% Sans serif math option
% % \if@doSans%
% % \usepackage[no-math]{fontspec}%	
% % \setmainfont{Flama-Light}%
% % \else%
% % \usepackage{fontspec}%	
% % \usefonttheme[onlymath]{serif}%
% % \fi%
% % \newfontfamily\Light{Flama-Light}%
% % \newfontfamily\Book{Flama-Book}%
% % \newfontfamily\Medium{Flama-Medium}%
% % \setsansfont{Flama-Light}%
% % \fi%

\renewcommand\UrlFont{\sffamily\bfseries}
% Titlepage
\setbeamerfont{title}{family=\sffamily,size=\fontsize{20}{20}}
\setbeamerfont{subtitle}{family=\sffamily,size=\fontsize{12}{14}}
\setbeamerfont{date}{size=\fontsize{8}{10}}
\setbeamerfont{author}{size=\fontsize{12}{15}}
\setbeamerfont{institute}{size=\fontsize{8}{10}}
% Section
\setbeamerfont{section title}{size=\LARGE}
% Content
\setbeamerfont{frametitle}{family=\sffamily,size=\large}
\setbeamerfont{copyright text}{family=\sffamily,size=\tiny}
\setbeamerfont{block title}{family=\sffamily\bfseries,size=\large}
\setbeamerfont{block title alerted}{family=\sffamily\bfseries,size=\large}
\setbeamerfont{alerted text}{family=\sffamily\bfseries}
% Captions
\setbeamerfont{caption name}{family=\sffamily\bfseries}

% ---------------------------------------------------------------------
% Titlepage
% ---------------------------------------------------------------------

% Titlepage structure
\def\maketitle{\ifbeamer@inframe\titlepage\else\frame[plain]{\titlepage}\fi}
\def\titlepage{\usebeamertemplate{title page}}
\setbeamertemplate{title page}{%
  
  % Add background to title page
  \tikz[remember picture, overlay]{%
    %% 
    \node at (current page.center) {%
      \includegraphics[width=\paperwidth]{background}%
    };%

    \node at (current page.center) {%
      \begin{minipage}[t][\paperheight]{\textwidth}
        \vspace*{5mm}
        \null%
        \includegraphics[height=15mm]{./logo-ufg-inline}%
        % 
        \hfill%
        \includegraphics[height=15mm]{./logo-emc}%
        \hspace*{4mm}%
        \par%

        \vspace*{2em}
        \ifx\inserttitle\@empty%
        \else%
        {%
          \usebeamerfont{title}%
          \usebeamercolor[fg]{title}%
          \MakeUppercase{\inserttitle}\par%
        }%
        \fi%

        \medskip%
        %% 
        \ifx\insertsubtitle\@empty%
        \else%
        {%
          \usebeamerfont{subtitle}%
          \usebeamercolor[fg]{subtitle}%
          \insertsubtitle\par%
        }%

        \bigskip%
        \fi%
        \ifx\insertdate\@empty%
        \else%
        {%
          \usebeamerfont{date}%
          \usebeamercolor[fg]{date}%
          \insertdate\par}%
        \fi% 
        
        \vfill%
        
        \ifx\insertauthor\@empty%
        \else%
        {%
          \usebeamerfont{author}%
          \usebeamercolor[fg]{author}%
          \insertauthor\par%
        }%
        
        \fi%
        \ifx\insertinstitut\@empty%
        \else%
        \medskip%
        {%
          \usebeamerfont{institute}%
          \usebeamercolor[fg]{institute}%
          \insertinstitute\par%
        }%
        \fi%

        \bigskip%
      \end{minipage}
    };%
  }
  %% 
  
}

% ---------------------------------------------------------------------
% Sectionpages
% ---------------------------------------------------------------------

% Make Sectionhead uppercase
\newcommand{\insertsectionHEAD}{%
  \expandafter\insertsectionHEADaux\insertsectionhead}
\newcommand{\insertsectionHEADaux}[3]{\MakeUppercase{#3}
}

\if@doSectionPage\@empty
\else
% Insert frame with section title at every section start
\AtBeginSection[]
{
  % \begingroup
  %% \setbeamercolor{background canvas}{bg=ufgWarmGreyDark}
  \tikz[remember picture, overlay]{%
    %% 
    \node at (current page.center) {%
      \includegraphics[width=\paperwidth]{background}%
    };%
    %% 
    \node (titulo) at (current page.north) [yshift=-8em] {%
      \centering%
      \expandafter\Large\MakeUppercase\insertsectionhead%\insertsectionHEAD%
    };%
    % \node (toc) [below= 4em of titulo,anchor=north east,xshift=4em] {%
    %   \begin{minipage}{.6\linewidth}
    %     \tableofcontents[currentsection]
    %   \end{minipage}
    % };
  }
}
\fi

% ---------------------------------------------------------------------
% Frametitle
% ---------------------------------------------------------------------
\setbeamertemplate{frametitle}{%
  \begin{beamercolorbox}[%
    wd=\paperwidth,leftskip=0.3cm,rightskip=0.3cm,ht=3ex,dp=1.5ex%
    ]{frametitle}
    \usebeamerfont{frametitle}%
    \MakeUppercase{\insertframetitle}%
  \end{beamercolorbox}
  % \tikz{%
  %   \node [rectangle,fill=\color{} minimum height=2mm, minimum width=.7\paperwidth]
  %   {};
  % }
}

% % ---------------------------------------------------------------------
% % Footline
% % ---------------------------------------------------------------------
% \usenavigationsymbolstemplate{}
% \setbeamertemplate{footline}
% {%
%   \begin{beamercolorbox}[wd=\textwidth,ht=3ex,dp=1.5ex,leftskip=0.3cm,rightskip=0.3cm]{structure}%
%     \hfill\usebeamerfont{page number in head/foot}%
%     \insertframenumber%
%   \end{beamercolorbox}%
% }

% ---------------------------------------------------------------------
% Captions
% ---------------------------------------------------------------------
\setbeamertemplate{caption label separator}{: }

% ---------------------------------------------------------------------
% Blocks
% ---------------------------------------------------------------------
\setbeamertemplate{block begin}
{
  \setbeamercolor{item}{parent=block body}
  \par\vskip\medskipamount%
  \begin{beamercolorbox}[sep=.5ex,dp=0.6ex,leftskip=0.5ex,rightskip=0.5ex]{block title}
    \usebeamerfont*{block title}\insertblocktitle%
  \end{beamercolorbox}%
  {\parskip0pt\par}%
  {\nointerlineskip\vskip-0.5pt}%
  \usebeamerfont{block body}%
  \begin{beamercolorbox}[sep=.5ex,dp=0.6ex,leftskip=0.5ex,rightskip=0.5ex,vmode]{block body}%
  }
  \setbeamertemplate{block end}  
  {\end{beamercolorbox}\vskip\smallskipamount}

\setbeamertemplate{block alerted begin}
{
  \setbeamercolor{item}{parent=block body alerted}
  \par\vskip\medskipamount%
  \begin{beamercolorbox}[sep=.5ex,dp=0.6ex,leftskip=0.5ex,rightskip=0.5ex]{block title alerted}
    \usebeamerfont*{block title alerted}\insertblocktitle%
  \end{beamercolorbox}%
  {\parskip0pt\par}%
  {\nointerlineskip\vskip-0.5pt}%
  \usebeamerfont{block body alerted}%
  \begin{beamercolorbox}[sep=.5ex,dp=0.6ex,leftskip=0.5ex,rightskip=0.5ex,vmode]{block body alerted}%
  }
  \setbeamertemplate{block alerted end}
  {\end{beamercolorbox}\vskip\smallskipamount}

\setbeamertemplate{block example begin}
{
  \par\vskip\medskipamount%
  \begin{beamercolorbox}[sep=.5ex,dp=0.6ex,leftskip=0.5ex,rightskip=0.5ex]{block title example}
    \usebeamerfont*{block title example}\insertblocktitle%
  \end{beamercolorbox}%
  {\parskip0pt\par}%
  {\nointerlineskip\vskip-0.5pt}%
  \usebeamerfont{block body example}%
  \begin{beamercolorbox}[sep=.5ex,dp=0.6ex,leftskip=0.5ex,rightskip=0.5ex,vmode]{block body example}%
  }
  \setbeamertemplate{block example end}
  {\end{beamercolorbox}\vskip\smallskipamount}


%% =============================================================================

% %%%%%%%%%%%%%%%%%%
% % The footer bar %
% %%%%%%%%%%%%%%%%%%

\usenavigationsymbolstemplate{}
\defbeamertemplate*{footline}{UFG}
{%
  \leavevmode% 
  % OBSERVATION: the "%" symbols inside hbox are all very important here.
  % The \hbox enviroment will insert spaces whenever there's whitespace
  % Adding a % at the END of each line ensures that any hard returns aren't
  % interpreted as white space. This allows the color boxes to be flush against
  % one another. If a faint white line appears one could probably do something like
  % hspace{-1px} and add an additional pixel-or-two wide beamercolorbox.	

  \hbox{%
    \begin{beamercolorbox}[%
      wd=.4\paperwidth,%
      ht=2.5ex,dp=1.125ex,%
      leftskip=.3cm,%
      rightskip=.3cm plus1fil%
      ]{author in head/foot}%
      \usebeamerfont{author in head/foot}\insertshortauthor%
    \end{beamercolorbox}%
    % 
    \begin{beamercolorbox}[%
      wd=.6\paperwidth,%
      ht=2.5ex,dp=1.125ex,%
      leftskip=.3cm,rightskip=.3cm plus1fil%
      ]{title in head/foot}%
      \usebeamerfont{title in head/foot}{%
        \textit \expandafter\MakeUppercase{\insertshorttitle}%
      } %
      \hskip2ex plus1fill%
      % \insertpagenumber\,/\,\insertpresentationendpage %% Want FRAME, not SLIDE number
      \insertframenumber/\inserttotalframenumber
    \end{beamercolorbox}%
  }%

  % This is a complete kludge for the faint white line which appears
  % between the beamer color boxes above. (It doesnt appear in presentation mode
  % but sometimes looks funny when the pdfs are viewed in a window)
  \begin{tikzpicture}[overlay]
    \usebeamercolor[bg]{author in head/foot}
    \draw[thick] (0,3.625ex) -- (\paperwidth,3.625ex);
    \draw (.4\paperwidth,0) -- (.4\paperwidth,3.625ex);
    \draw[thick] (0,0) -- (\paperwidth,0);
  \end{tikzpicture}



  %% \ifbeamer@Zurich@bigpagenumber
  \begin{tikzpicture}[overlay]
    \usebeamercolor[bg]{author in head/foot}
    \draw[fill] (\paperwidth-5ex,3.625ex) circle  (6ex);
    \color{white}
    \draw[fill] (\paperwidth-5ex,3.625ex) circle (5ex);
    \usebeamercolor[fg]{author in head/foot}
    \node at (\paperwidth-5ex,4ex) {%
      \footnotesize$^\text{\insertframenumber}/_\text{\inserttotalframenumber}$%
    };
  \end{tikzpicture}
  %% \fi
}


%% =============================================================================


\newcommand{\InsereBackgroung}{%
  \begin{tikzpicture}[remember picture, overlay]%
    \node at (current page.center) [opacity=1] {%
      \includegraphics[width=\paperwidth]{background}%
    };%
  \end{tikzpicture}
}


\mode<all>

